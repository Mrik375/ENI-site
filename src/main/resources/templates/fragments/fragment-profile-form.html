<form id="form-creer" class="form-place" data-th-fragment="profile-form(action)" data-th-action="@{${action}}"
      method="post" data-th-object="${utilisateur}">

    <h3 data-th-unless="${action == '/creercompte'}" data-th-text="#{frag-profile.h3}"></h3>

    <div data-th-replace="~{:: inputField('__#{frag-profile-form.div.pseudo}__', 'pseudo', ~{}, false)}"></div>

    <div data-th-replace="~{:: inputField('Nom :', 'nom', ~{}, false)}" data-th-text="#{frag-profile-form.div.nom}"></div>

    <div data-th-replace="~{:: inputField('Prénom :', 'prenom', ~{}, false)}" data-th-text="#{frag-profile-form.div.prenom}"></div>

    <div data-th-replace="~{:: inputField('Email :', 'email', 'email', false)}" data-th-text="#{frag-profile-form.div.mail}"></div>

    <div data-th-replace="~{:: inputField('Téléphone :', 'telephone', ~{}, false)}" data-th-text="#{frag-profile-form.div.tel}"></div>

    <fieldset>
        <label data-th-text="#{frag-profile.label}"></label>
        <div data-th-replace="~{:: inputField('Rue :', 'adresse.rue', ~{}, true)}" data-th-text="#{frag-profile-form.div.rue}"></div>
        <div data-th-replace="~{:: inputField('Code Postal :', 'adresse.codePostal', ~{}, true)}" data-th-text="#{frag-profile-form.div.code}"></div>
        <div data-th-replace="~{:: inputField('Ville :', 'adresse.ville', ~{}, true)}" data-th-text="#{frag-profile-form.div.}"></div>
        <div data-th-replace="~{:: inputField('', 'adresse', ~{}, true)}"></div>
    </fieldset>

    <div data-th-if="${editable && editField != null}">
        <input  type="hidden" name="field" data-th-value="${editField}"/>
        <button type="submit" name="action" value="modifier" data-th-text="#{frag-profile.button.en}"></button>
        <button type="submit" name="action" value="annuler" data-th-text="#{frag-profile.button.an}"></button>
    </div>


    <div id="div-mdp" data-th-if="${action == '/creercompte'}">
        <label for="motDePasse">Mot de passe (*):</label>
        <input type="password" id="motDePasse" data-th-field="*{motDePasse}" required><br><br>
<div data-th-replace="~{fragments/errors/fragment-error :: frag-error('motDePasse')}"></div>

        <label for="confirmMDP">Confirmation (*):</label>
        <input type="password" id="confirmMDP" name="confirmMDP" required><br>
        <p id="p-erreur"></p><br>

    <div id="div-mdp" data-th-if="${action == '/creercompte'}">
        <label for="motDePasse" data-th-text="#{frag-profile.label.mdp}"></label>
        <input type="password" id="motDePasse" data-th-field="*{motDePasse}" required><br><br>
<div data-th-replace="~{fragments/errors/fragment-error :: frag-error('motDePasse')}"></div>

        <label for="confirmMDP" data-th-text="#{frag-profile.label.conf}"></label>
        <input type="password" id="confirmMDP" name="confirmMDP" required><br><br>
		<p id="p-erreur"></p><br>

        <button type="submit" data-th-text="#{frag-profile.button}"></button>
    </div>
</form>

<div data-th-fragment="inputField(label, field, type='text', isAddress)">
    <!-- Label toujours présent-->
    <label data-th-for="${field}" data-th-text="${label}"></label>

    <!--    Section création de compte-->
    <div data-th-if="${action == '/creercompte' && label != ''}">
        <!--data-th-field="*{__${field}__}" ne fonctionne pas si le fragment a plus de 1 attribut -->
        <!--<input data-th-type="${type}" data-th-id="${field}" data-th-field="*{__${field}__}" required><br><br>-->
        <div data-th-replace="~{:: creercompte(${field})}"></div>
    </div>

    <!--    Profil-->
    <div data-th-unless="${action == '/creercompte'}">
        <!--Profil non editable -->
        <span data-th-if="${!editable && label != ''}" data-th-id="${field}" data-th-text="${utilisateur.__${field}__}"></span>

        <!--Profil editable -->
        <div data-th-if="${editable}">
            <span data-th-if="${editField != field && field != 'adresse'}" data-th-id="${field}" data-th-text="${#authentication.getPrincipal().__${field}__}"></span>
            <input data-th-if="${label != '' && (editField == field || (editField == 'adresse' && isAddress))}" data-th-type="${type}" data-th-id="${field}" data-th-name="${field}" data-th-value="${#authentication.getPrincipal().__${field}__}"/>
            <button data-th-if="${editField != field && action == '/profil' && !isAddress}" type="submit" data-th-name="editField" data-th-value="${field}">Modifier</button>
            <button data-th-if="${field == 'adresse' && action == '/profil' && isAddress}" type="submit" data-th-name="editField" data-th-value="${field}">Modifier Adresse</button>
        </div>
    </div>

    <!-- Erreurs -->
    <div data-th-replace="~{fragments/errors/fragment-error :: frag-error(${field})}"></div>
</div>

<div data-th-fragment="creercompte(field)">
    <input data-th-unless="${field == 'email'}" data-th-type="text" data-th-id="pseudo" data-th-field="*{__${field}__}" required>
    <input data-th-if="${field == 'email'}" data-th-type="email" data-th-id="pseudo" data-th-field="*{__${field}__}" required>
</div>